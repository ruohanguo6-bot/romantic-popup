<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>å…¬å­ä½³äºº</title>

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;height:100vh;overflow:hidden;
      font-family: system-ui,-apple-system,"PingFang SC","Microsoft YaHei",sans-serif;
      color:#fff;
      background:
        radial-gradient(900px 700px at 20% 20%, rgba(255,105,180,.18), transparent 60%),
        radial-gradient(900px 700px at 80% 40%, rgba(138,43,226,.14), transparent 60%),
        radial-gradient(900px 900px at 50% 100%, rgba(64,224,208,.08), transparent 65%),
        #06060a;
    }

    /* èƒŒæ™¯å±‚ï¼šå…ˆæ˜¾ç¤ºæ¸å˜åº•è‰²ï¼Œå›¾ç‰‡åŠ è½½å¥½å†æ›¿æ¢ */
    .bg{
      position:fixed; inset:0;
      background-position:center;
      background-size:cover;
      opacity:0;
      transition: opacity 2.8s ease;
      z-index:-3;
    }
    .bg.show{ opacity:1; }

    .vignette{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(70% 62% at 50% 34%, rgba(0,0,0,0) 42%, rgba(0,0,0,.45) 100%),
        linear-gradient(to bottom, rgba(0,0,0,.08), rgba(0,0,0,.18));
      pointer-events:none;
    }

    .tip{
      position:fixed; top:14px; left:14px;
      padding:8px 14px;
      border-radius:999px;
      background: rgba(0,0,0,.32);
      font-size:14px;
      letter-spacing:.12em;
      z-index:30;
      user-select:none;
    }

    /* å±å¹•ä¸­é—´çš„çŠ¶æ€æç¤ºï¼ˆåªåœ¨å‡ºé—®é¢˜æ—¶æ˜¾ç¤ºï¼‰ */
    .status{
      position:fixed; left:50%; top:50%;
      transform:translate(-50%,-50%);
      padding:12px 14px;
      border-radius:14px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      font-size:13px;
      z-index:35;
      max-width:min(88vw,520px);
      text-align:center;
      line-height:1.5;
    }
    .status.hidden{ display:none; }

    #layer{
      position:fixed; inset:0;
      z-index:10;
      pointer-events:none;
    }

    .bubble{
      position:absolute;
      max-width:min(74vw, 460px);
      padding:10px 12px;
      border-radius:16px;
      background: var(--bg, rgba(255,255,255,.70));
      color: rgba(20,20,28,.92);
      border: 1px solid rgba(255,255,255,.45);
      box-shadow: 0 12px 30px rgba(0,0,0,.18);
      font-size:13px;
      line-height:1.45;
      opacity:0;
      transform: translateY(14px) scale(.975);
      filter: blur(1px);
      will-change: transform, opacity;
    }
    .bubble.show{
      opacity:1;
      filter: blur(0);
      transform: translateY(0) scale(1);
      transition: opacity 1.7s ease, transform 2.3s cubic-bezier(.18,.9,.18,1), filter 1.7s ease;
    }
    .bubble.float{ animation: drift 7s ease-in-out infinite; }
    @keyframes drift{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    .bubble.fade{ opacity:.15; transition: opacity 6s ease; }

    .heart{
      position:fixed; left:var(--x); top:var(--y);
      transform:translate(-50%,-50%);
      font-size:18px; opacity:0;
      pointer-events:none;
      animation: floatUp 2.6s linear forwards;
      z-index:40;
    }
    @keyframes floatUp{
      0%{opacity:0; transform:translate(-50%,-20%) scale(.8);}
      15%{opacity:.7;}
      100%{opacity:0; transform:translate(calc(-50% + var(--dx)),-260px) scale(1.3);}
    }
  </style>
</head>

<body>
  <div id="bg1" class="bg"></div>
  <div id="bg2" class="bg"></div>
  <div class="vignette"></div>

  <div class="tip">å…¬å­ä½³äºº</div>
  <div id="status" class="status">æ­£åœ¨åŠ è½½èƒŒæ™¯â€¦ï¼ˆå¦‚æœä¸€ç›´åœåœ¨è¿™ï¼Œè¯´æ˜å›¾ç‰‡è·¯å¾„/æ–‡ä»¶åæœ‰é—®é¢˜ï¼‰</div>
  <div id="layer"></div>

  <!-- BGMï¼šä¸é¢„åŠ è½½ï¼Œé¿å…æ‹–æ­»é¦–å± -->
  <audio id="bgm" src="bgm.mp3" loop preload="none" playsinline webkit-playsinline></audio>

  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    const status = document.getElementById("status");
    const bg1 = document.getElementById("bg1");
    const bg2 = document.getElementById("bg2");
    const layer = document.getElementById("layer");

    // âœ… è¿™é‡Œä¼šè‡ªåŠ¨â€œå¸¦ç‰ˆæœ¬å·â€ï¼Œé¿å… GitHub Pages ç¼“å­˜å¯¼è‡´ä½ æ˜æ˜æ”¹äº†ä½†è¿˜æ˜¯æ—§æ–‡ä»¶
    const BG1_URL = "bg1.jpg?v=2";
    const BG2_URL = "bg2.jpg?v=2";

    function preload(url){
      return new Promise((resolve, reject)=>{
        const img = new Image();
        img.onload = () => resolve(url);
        img.onerror = () => reject(url);
        img.src = url;
      });
    }

    // 1) å…ˆé¢„åŠ è½½ä¸¤å¼ èƒŒæ™¯ï¼šæˆåŠŸäº†å†æ˜¾ç¤ºï¼ˆé¿å…é»‘å±ï¼‰
    try{
      await Promise.all([preload(BG1_URL), preload(BG2_URL)]);
      bg1.style.backgroundImage = `url("${BG1_URL}")`;
      bg2.style.backgroundImage = `url("${BG2_URL}")`;
      bg1.classList.add("show");         // å…ˆæ˜¾ç¤ºç¬¬ä¸€å¼ 
      status.classList.add("hidden");
    }catch(e){
      // èƒŒæ™¯åŠ è½½å¤±è´¥ä¹Ÿä¸ä¼šé»‘å±ï¼šä¿ç•™æ¸å˜åº•ï¼Œå¹¶æç¤ºä½ è¦æ£€æŸ¥æ–‡ä»¶å/è·¯å¾„
      status.textContent = "èƒŒæ™¯åŠ è½½å¤±è´¥ï¼šè¯·ç¡®è®¤ä»“åº“æ ¹ç›®å½•æœ‰ bg1.jpg å’Œ bg2.jpgï¼ˆå…¨å°å†™ï¼‰ï¼Œç„¶åå¼ºåˆ·é¡µé¢ã€‚";
      // è¿™é‡Œä»ç„¶è®©ä½ èƒ½çœ‹åˆ°é¡µé¢ï¼Œä¸ä¼šçº¯é»‘
    }

    // 2) èƒŒæ™¯äº¤æ›¿ï¼ˆåªæœ‰èƒŒæ™¯æˆåŠŸæ˜¾ç¤ºåæ‰äº¤æ›¿ï¼‰
    let toggle = true;
    setInterval(()=>{
      if(!bg1.classList.contains("show")) return; // èƒŒæ™¯æ²¡åŠ è½½æˆåŠŸå°±ä¸åˆ‡
      bg1.style.opacity = toggle ? 0 : 1;
      bg2.style.opacity = toggle ? 1 : 0;
      toggle = !toggle;
    }, 12000);

    // 3) æ°”æ³¡ï¼ˆæœ¦èƒ§ã€å‡è¡¡ã€ä¸è‡ƒè‚¿ï¼‰
    const texts = [
      "é‚£ä»¥çˆ±ä¸ºåçš„éª—å­ï¼Œæœ¬ä¸é…å¾—åˆ°å“€æ‚¼ã€‚",
      "ç¥æ˜ä¸æ˜¯æ¯ä¸ªäººéƒ½ä¼šçœ·é¡¾çš„ã€‚",
      "å¦‚æœé›ªåœ°è¶³å¤Ÿå¹²å‡€ï¼Œè„šå°ç•™ä¸‹æ¥ï¼Œæœ¬èº«ä¹Ÿä¸æ˜¯ä»€ä¹ˆåäº‹ã€‚",
      "è®°ä½ä½ ï¼Œçˆ±ä¸Šä½ ï¼Œç›´åˆ°æ­»äº¡å°†ä½ å¸¦èµ°ã€‚",
      "è¿™ä¸€æ¬¡ï¼Œæˆ‘æ˜¯ä¸ºä½ è€Œæ¥çš„ç¥æ˜ã€‚"
    ];
    const colors = [
      "rgba(255,255,255,.70)",
      "rgba(251,235,255,.68)",
      "rgba(236,243,255,.68)",
      "rgba(236,255,248,.64)",
      "rgba(255,247,232,.66)",
      "rgba(242,238,255,.66)"
    ];
    const recent = [];
    function pickText(){
      let t = texts[Math.floor(Math.random()*texts.length)];
      let g=0;
      while(recent.includes(t) && g<10){ t = texts[Math.floor(Math.random()*texts.length)]; g++; }
      recent.push(t); if(recent.length>3) recent.shift();
      return t;
    }
    function clamp(n,min,max){ return Math.max(min,Math.min(max,n)); }

    function spawn(){
      const b = document.createElement("div");
      b.className = "bubble";
      b.textContent = pickText();
      b.style.setProperty("--bg", colors[Math.floor(Math.random()*colors.length)]);

      const w=innerWidth, h=innerHeight;
      const r=Math.random();
      let x = r<0.34 ? w*(0.10+Math.random()*0.32)
            : r<0.68 ? w*(0.58+Math.random()*0.32)
            : w*(0.30+Math.random()*0.40);
      let y = h*(0.22+Math.random()*0.64);

      layer.appendChild(b);
      const bw=b.offsetWidth||300, bh=b.offsetHeight||40;
      b.style.left = clamp(x,10,w-bw-10)+"px";
      b.style.top  = clamp(y,70,h-bh-18)+"px";

      requestAnimationFrame(()=>{
        b.classList.add("show");
        if(Math.random()<0.7) b.classList.add("float");
      });

      if(layer.children.length>14) layer.children[0].classList.add("fade");
      if(layer.children.length>20){
        const o=layer.children[0];
        setTimeout(()=>o&&o.remove(),6000);
      }

      setTimeout(spawn, 620+Math.random()*980);
    }
    setTimeout(spawn,420);
    setTimeout(spawn,1150);

    // 4) çˆ±å¿ƒï¼ˆå…‹åˆ¶ï¼‰
    const hearts=["ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’•"];
    document.addEventListener("click",(e)=>{
      for(let k=0;k<3;k++){
        const h=document.createElement("div");
        h.className="heart";
        h.textContent=hearts[Math.floor(Math.random()*hearts.length)];
        h.style.setProperty("--x", e.clientX+"px");
        h.style.setProperty("--y", e.clientY+"px");
        h.style.setProperty("--dx",(Math.random()*120-60)+"px");
        document.body.appendChild(h);
        h.addEventListener("animationend",()=>h.remove());
      }
    },{passive:true});

    // 5) BGMï¼šé¦–æ¬¡äº¤äº’æ’­æ”¾ï¼ˆå¾®ä¿¡å¿…é¡»ï¼‰
    const bgm=document.getElementById("bgm");
    let started=false;
    async function play(){
      if(started) return;
      try{ bgm.volume=0.26; await bgm.play(); started=true; }catch(e){}
    }
    document.addEventListener("click",play,{once:true});
    document.addEventListener("touchstart",play,{once:true});
  });
  </script>
</body>
</html>
